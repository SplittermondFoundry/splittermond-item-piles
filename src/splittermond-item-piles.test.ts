import {describe, it} from "mocha";
import {expect} from "chai";
import {release_13_config} from "./splittermond-item-piles";
import sinon from "sinon";

describe("Item Piles conversion", () => {
    [
        ["1S", 100],
        ["15T", 0.15],
        ["2S 3 T", 200.03],
        ["  1 L  2 T", 1.02]
    ].forEach(([input, expectation]) => {
        it(`should convert ${input} to ${expectation}`, () => {
            const transformedCost = release_13_config.ITEM_COST_TRANSFORMER({system: {price: input}}, release_13_config.CURRENCIES);
            expect(transformedCost).to.equal(expectation);
        });
    });
});

describe("Version generation", () => {
    it("should generate correct version list", async () => {
        const systemIntegrationMock = sinon.stub().resolves();
        global.game = {
            itempiles: {
                API: {
                    addSystemIntegration: systemIntegrationMock
                }
            }
        }

        await Promise.all(Array.from(global.Hooks.map.values()).flatMap((a: Function[]) => a).map(async (func) => await func()))
        const versions = systemIntegrationMock.args.flatMap(([__, version]) => version)
        expect(versions).to.deep.equal([
            "13.5.0", "13.5.1", "13.5.2", "13.5.3", "13.5.4", "13.5.5", "13.5.6", "13.5.7", "13.5.8", "13.5.9",
            "13.5.10", "13.5.11", "13.5.12", "13.5.13", "13.5.14", "13.5.15", "13.5.16", "13.5.17", "13.5.18", "13.5.19",
            "13.5.20", "13.5.21", "13.5.22", "13.5.23", "13.5.24", "13.5.25",
            "13.6.0", "13.6.1", "13.6.2", "13.6.3", "13.6.4", "13.6.5", "13.6.6", "13.6.7", "13.6.8", "13.6.9",
            "13.6.10", "13.6.11", "13.6.12", "13.6.13", "13.6.14", "13.6.15", "13.6.16", "13.6.17", "13.6.18", "13.6.19",
            "13.6.20", "13.6.21", "13.6.22", "13.6.23", "13.6.24", "13.6.25",
            "13.7.0", "13.7.1", "13.7.2", "13.7.3", "13.7.4", "13.7.5", "13.7.6", "13.7.7", "13.7.8", "13.7.9",
            "13.7.10", "13.7.11", "13.7.12", "13.7.13", "13.7.14", "13.7.15", "13.7.16", "13.7.17", "13.7.18", "13.7.19",
            "13.7.20", "13.7.21", "13.7.22", "13.7.23", "13.7.24", "13.7.25",
            "13.8.0", "13.8.1", "13.8.2", "13.8.3", "13.8.4", "13.8.5", "13.8.6", "13.8.7", "13.8.8", "13.8.9",
            "13.8.10", "13.8.11", "13.8.12", "13.8.13", "13.8.14", "13.8.15", "13.8.16", "13.8.17", "13.8.18", "13.8.19",
            "13.8.20", "13.8.21", "13.8.22", "13.8.23", "13.8.24", "13.8.25",
            "13.9.0", "13.9.1", "13.9.2", "13.9.3", "13.9.4", "13.9.5", "13.9.6", "13.9.7", "13.9.8", "13.9.9",
            "13.9.10", "13.9.11", "13.9.12", "13.9.13", "13.9.14", "13.9.15", "13.9.16", "13.9.17", "13.9.18", "13.9.19",
            "13.9.20", "13.9.21", "13.9.22", "13.9.23", "13.9.24", "13.9.25",
            "13.10.0", "13.10.1", "13.10.2", "13.10.3", "13.10.4", "13.10.5", "13.10.6", "13.10.7", "13.10.8", "13.10.9",
            "13.10.10", "13.10.11", "13.10.12", "13.10.13", "13.10.14", "13.10.15", "13.10.16", "13.10.17", "13.10.18", "13.10.19", "13.10.20",
            "13.10.21", "13.10.22", "13.10.23", "13.10.24", "13.10.25",
            "13.11.0", "13.11.1", "13.11.2", "13.11.3", "13.11.4", "13.11.5", "13.11.6", "13.11.7", "13.11.8", "13.11.9", "13.11.10",
            "13.11.11", "13.11.12", "13.11.13", "13.11.14", "13.11.15", "13.11.16", "13.11.17", "13.11.18", "13.11.19", "13.11.20",
            "13.11.21", "13.11.22", "13.11.23", "13.11.24", "13.11.25",
            "13.12.0", "13.12.1", "13.12.2", "13.12.3", "13.12.4", "13.12.5", "13.12.6", "13.12.7", "13.12.8", "13.12.9",
            "13.12.10", "13.12.11", "13.12.12", "13.12.13", "13.12.14", "13.12.15", "13.12.16", "13.12.17", "13.12.18", "13.12.19",
            "13.12.20", "13.12.21", "13.12.22", "13.12.23", "13.12.24", "13.12.25",
            "13.13.0", "13.13.1", "13.13.2", "13.13.3", "13.13.4", "13.13.5", "13.13.6", "13.13.7", "13.13.8", "13.13.9", "13.13.10",
            "13.13.11", "13.13.12", "13.13.13", "13.13.14", "13.13.15", "13.13.16", "13.13.17", "13.13.18", "13.13.19", "13.13.20",
            "13.13.21", "13.13.22", "13.13.23", "13.13.24", "13.13.25",
            "13.14.0", "13.14.1", "13.14.2", "13.14.3", "13.14.4", "13.14.5", "13.14.6", "13.14.7", "13.14.8", "13.14.9",
            "13.14.10", "13.14.11", "13.14.12", "13.14.13", "13.14.14", "13.14.15", "13.14.16", "13.14.17", "13.14.18", "13.14.19",
            "13.14.20", "13.14.21", "13.14.22", "13.14.23", "13.14.24", "13.14.25",
            "13.15.0",
        ]);
    });

});
